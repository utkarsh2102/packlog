## packlog: Log your Packets! \o/

`packlog` is a simple kernel module which will log all your incoming packets, one-by-one. What for? Nothing, but fun!  
With this, you can see how many packets are being transferred when you make a simple HTTP(S) request, or even otherwise.

---

## Compiling

Well, we use `make` for compiling, so that's something your system should have.  
Maybe you'll also need the `build-essential` package, which is readily available to install via your package manager.

- So, clone the repository:
    ```bash
    $ git clone https://github.com/utkarsh2102/packlog
    ```

- Run make to compile the source.
    ```bash
    $ make
    ```

And there you go! Done!  
You'll see a bunch of binaries and files generated by this. And the only thing we're interested in is `packlog.ko`.

From [StackOverflow](https://stackoverflow.com/a/10477109),
> The **.ko** file is your object file linked with some kernel automatically generated data structures that are needed by the kernel.

---

## Using

Now since we have `packlog.ko` ready, let's use it!

- Insert the compiled kernel module:
    ```bash
    $ sudo insmod packlog.ko
    ```

- Now that the module is intialized, let's see the incoming packets:
    ```bash
    $ sudo dmesg | tail
    ```

- At this point, you'll see some packets already have started to get logged. Let's make a HTTP request now and see what happens. Open Firefox and open any site, or type the following in another terminal:
    ```bash
    $ firefox utkarsh2102.com
    ```
    You'll see a spike in the number of packets. Obviously, eh? But fun, isn't it? But can you guess why the number of packets keep increasing? Which packets are these? Any idea? ^.^

- Anyway, now that fun time's over, let's remove the inserted module:
    ```bash
    $ sudo rmmod packlog
    ```

- Finally, check the `dmesg` logs to ensure that the module has been removed:
    ```bash
    $ sudo dmesg | tail
    ```

---

## DIY Time

Want to do something fun? Let's drop all the incoming packets. What do you think will happen?

Let's find out!

- Step 1: In the `tmp_hook` function in `packlog.c`, change `NF_ACCEPT` to `NF_DROP`. Or use the following command:
    ``` bash
    $ sed -i 's/NF_ACCEPT/NF_DROP/g' packlog.c
    ```

- Step 2: Recompile.
    ```bash
    $ make
    ```

- Step 3: Re-insert the compiled module.
    ```bash
    $ sudo insmod packlog.ko
    ```

- Step 4: Ensure that the module has been initialzed.
    ```bash
    $ sudo dmesg | tail
    ```

- Step 5: Shoot up your browser and try to access any site.  
  What happens? Does it work as usual? Why? Why not? What do you think? ^_^

- Step 6: Okay, great stuff. But let's go back to our sane life.
    ```bash
    $ sudo rmmod packlog
    ```

- Step 7: Lastly, ensure that the module has indeed been removed.
    ```bash
    $ sudo dmesg | tail
    ```

---
